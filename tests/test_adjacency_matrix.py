import unittest
import os
from netomaton import *

THIS_DIR = os.path.dirname(os.path.abspath(__file__))


class TestAdjacencyMatrix(unittest.TestCase):

    def test_n3_r0_ca(self):
        matrix = AdjacencyMatrix.cellular_automaton(n=3, r=0)
        expected = [[1., 0., 0.],
                    [0., 1., 0.],
                    [0., 0., 1.]]
        self.assertEqual(expected, matrix)

    def test_n3_r1_ca(self):
        matrix = AdjacencyMatrix.cellular_automaton(n=3)
        expected = [[1., 1., 1.],
                    [1., 1., 1.],
                    [1., 1., 1.]]
        self.assertEqual(expected, matrix)

    def test_n5_r1_ca(self):
        matrix = AdjacencyMatrix.cellular_automaton(n=5)
        expected = [[1., 1., 0., 0., 1.],
                    [1., 1., 1., 0., 0.],
                    [0., 1., 1., 1., 0.],
                    [0., 0., 1., 1., 1.],
                    [1., 0., 0., 1., 1.]]
        self.assertEqual(expected, matrix)

    def test_n5_r2_ca(self):
        matrix = AdjacencyMatrix.cellular_automaton(n=5, r=2)
        expected = [[1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1.]]
        self.assertEqual(expected, matrix)

    def test_n7_r2_ca(self):
        matrix = AdjacencyMatrix.cellular_automaton(n=7, r=2)
        expected = [[1., 1., 1., 0., 0., 1., 1.],
                    [1., 1., 1., 1., 0., 0., 1.],
                    [1., 1., 1., 1., 1., 0., 0.],
                    [0., 1., 1., 1., 1., 1., 0.],
                    [0., 0., 1., 1., 1., 1., 1.],
                    [1., 0., 0., 1., 1., 1., 1.],
                    [1., 1., 0., 0., 1., 1., 1.]]
        self.assertEqual(expected, matrix)

    def test_n9_r0_vonNeumann_ca2d(self):
        matrix = AdjacencyMatrix.cellular_automaton2d(n=9, r=0, neighbourhood='von Neumann')
        expected = [[1., 0., 0., 0., 0., 0., 0., 0., 0.],
                    [0., 1., 0., 0., 0., 0., 0., 0., 0.],
                    [0., 0., 1., 0., 0., 0., 0., 0., 0.],
                    [0., 0., 0., 1., 0., 0., 0., 0., 0.],
                    [0., 0., 0., 0., 1., 0., 0., 0., 0.],
                    [0., 0., 0., 0., 0., 1., 0., 0., 0.],
                    [0., 0., 0., 0., 0., 0., 1., 0., 0.],
                    [0., 0., 0., 0., 0., 0., 0., 1., 0.],
                    [0., 0., 0., 0., 0., 0., 0., 0., 1.]]
        self.assertEqual(expected, matrix)

    def test_n9_r1_vonNeumann_ca2d(self):
        matrix = AdjacencyMatrix.cellular_automaton2d(n=9, r=1, neighbourhood='von Neumann')
        expected = [[1., 1., 1., 1., 0., 0., 1., 0., 0.],
                    [1., 1., 1., 0., 1., 0., 0., 1., 0.],
                    [1., 1., 1., 0., 0., 1., 0., 0., 1.],
                    [1., 0., 0., 1., 1., 1., 1., 0., 0.],
                    [0., 1., 0., 1., 1., 1., 0., 1., 0.],
                    [0., 0., 1., 1., 1., 1., 0., 0., 1.],
                    [1., 0., 0., 1., 0., 0., 1., 1., 1.],
                    [0., 1., 0., 0., 1., 0., 1., 1., 1.],
                    [0., 0., 1., 0., 0., 1., 1., 1., 1.]]
        self.assertEqual(expected, matrix)

    def test_n25_r2_vonNeumann_ca2d(self):
        matrix = AdjacencyMatrix.cellular_automaton2d(n=25, r=2, neighbourhood='von Neumann')
        expected = [[1., 1., 1., 1., 1., 1., 1., 0., 0., 1., 1., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 1., 0., 0., 1.],
                    [1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0., 0., 1., 1., 1., 0., 0.],
                    [1., 1., 1., 1., 1., 0., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0., 0., 1., 1., 1., 0.],
                    [1., 1., 1., 1., 1., 0., 0., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0., 0., 1., 1., 1.],
                    [1., 1., 1., 1., 1., 1., 0., 0., 1., 1., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 1., 0., 0., 1., 1.],
                    [1., 1., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 1., 1., 0., 0., 0., 0., 1., 0., 0., 0., 0.],
                    [1., 1., 1., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0., 0.],
                    [0., 1., 1., 1., 0., 1., 1., 1., 1., 1., 0., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0.],
                    [0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0.],
                    [1., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 1., 1., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1.],
                    [1., 0., 0., 0., 0., 1., 1., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 1., 1., 0., 0., 0., 0.],
                    [0., 1., 0., 0., 0., 1., 1., 1., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0.],
                    [0., 0., 1., 0., 0., 0., 1., 1., 1., 0., 1., 1., 1., 1., 1., 0., 1., 1., 1., 0., 0., 0., 1., 0., 0.],
                    [0., 0., 0., 1., 0., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 1., 1., 1., 0., 0., 0., 1., 0.],
                    [0., 0., 0., 0., 1., 1., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 1., 1., 0., 0., 0., 0., 1.],
                    [1., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 1., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 1.],
                    [0., 1., 0., 0., 0., 0., 1., 0., 0., 0., 1., 1., 1., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0.],
                    [0., 0., 1., 0., 0., 0., 0., 1., 0., 0., 0., 1., 1., 1., 0., 1., 1., 1., 1., 1., 0., 1., 1., 1., 0.],
                    [0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 1., 1., 1.],
                    [0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 1., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 1., 1.],
                    [1., 1., 0., 0., 1., 1., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 1., 0., 0., 1., 1., 1., 1., 1., 1.],
                    [1., 1., 1., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0., 0., 1., 1., 1., 0., 0., 1., 1., 1., 1., 1.],
                    [0., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0., 0., 1., 1., 1., 0., 1., 1., 1., 1., 1.],
                    [0., 0., 1., 1., 1., 0., 0., 0., 1., 0., 0., 0., 0., 1., 0., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1.],
                    [1., 0., 0., 1., 1., 0., 0., 0., 0., 1., 0., 0., 0., 0., 1., 1., 0., 0., 1., 1., 1., 1., 1., 1., 1.]]
        self.assertEqual(expected, matrix)

    def test_n9_r0_Moore_ca2d(self):
        matrix = AdjacencyMatrix.cellular_automaton2d(n=9, r=0, neighbourhood='Moore')
        expected = [[1., 0., 0., 0., 0., 0., 0., 0., 0.],
                    [0., 1., 0., 0., 0., 0., 0., 0., 0.],
                    [0., 0., 1., 0., 0., 0., 0., 0., 0.],
                    [0., 0., 0., 1., 0., 0., 0., 0., 0.],
                    [0., 0., 0., 0., 1., 0., 0., 0., 0.],
                    [0., 0., 0., 0., 0., 1., 0., 0., 0.],
                    [0., 0., 0., 0., 0., 0., 1., 0., 0.],
                    [0., 0., 0., 0., 0., 0., 0., 1., 0.],
                    [0., 0., 0., 0., 0., 0., 0., 0., 1.]]
        self.assertEqual(expected, matrix)

    def test_n9_r1_Moore_ca2d(self):
        matrix = AdjacencyMatrix.cellular_automaton2d(n=9, r=1, neighbourhood='Moore')
        expected = [[1., 1., 1., 1., 1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1., 1., 1., 1., 1.],
                    [1., 1., 1., 1., 1., 1., 1., 1., 1.]]
        self.assertEqual(expected, matrix)

    def test_n49_r2_Moore_ca2d(self):
        matrix = AdjacencyMatrix.cellular_automaton2d(n=49, r=2, neighbourhood='Moore')
        with open(os.path.join(THIS_DIR, 'resources', 'adjacency_n49_r2_Moore_ca2d.txt'), 'r') as content_file:
            content = content_file.read()
        expected = eval(content)
        self.assertEqual(expected, matrix)
